name: Debug Database Connection

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
    - name: 🔍 Debug Database on Hostinger
      uses: appleboy/ssh-action@v1.0.0
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        port: ${{ secrets.SSH_PORT }}
        script: |
          echo "🔍 Database Debug Report"
          echo "======================="
          
          cd domains/dokterkuklinik.com/public_html
          
          echo "📋 Current .env database config:"
          grep "^DB_" .env 2>/dev/null || echo "No .env or no DB config"
          
          echo -e "\n🔌 MySQL service status:"
          mysqladmin ping 2>/dev/null && echo "✅ MySQL running" || echo "❌ MySQL not responding"
          
          echo -e "\n🏠 Testing database hosts:"
          for host in localhost 127.0.0.1; do
            echo -n "Testing $host:3306 - "
            nc -zv $host 3306 2>&1 | grep -q "succeeded" && echo "✅ Open" || echo "❌ Closed"
          done
          
          echo -e "\n📊 Available databases (trying different usernames):"
          for user in u454362045 root; do
            echo "Trying user: $user"
            mysql -h localhost -u "$user" -pLaTahzan@01 -e "SHOW DATABASES;" 2>/dev/null | grep u454362045 || echo "Access denied for $user"
          done
          
          echo -e "\n🔍 Common Hostinger database patterns:"
          # Pattern 1: Account + klinik
          DB1="u454362045_klinik"
          echo "Testing: $DB1"
          mysql -h localhost -u "$DB1" -pLaTahzan@01 -e "SELECT 'OK' as status;" 2>/dev/null && echo "✅ $DB1 works!" || echo "❌ $DB1 failed"
          
          # Pattern 2: Account + dokterkuklinik  
          DB2="u454362045_dokterkuklinik"
          echo "Testing: $DB2"
          mysql -h localhost -u "$DB2" -pLaTahzan@01 -e "SELECT 'OK' as status;" 2>/dev/null && echo "✅ $DB2 works!" || echo "❌ $DB2 failed"
          
          # Pattern 3: Your specified
          DB3="u454362045_u45436245_kli"
          echo "Testing: $DB3"
          mysql -h localhost -u "$DB3" -pLaTahzan@01 -e "SELECT 'OK' as status;" 2>/dev/null && echo "✅ $DB3 works!" || echo "❌ $DB3 failed"
          
          echo -e "\n📁 File structure:"
          ls -la | head -10
          
          echo -e "\n🎯 Final recommendation:"
          echo "1. Check cPanel → MySQL Databases"
          echo "2. Verify database name and user match exactly"  
          echo "3. Reset database password if needed"
          echo "4. Common pattern: u454362045_[suffix]"