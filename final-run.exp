#!/usr/bin/expect -f

set timeout 120

spawn ssh -p 65002 u454362045@153.92.8.132
expect "password:"
send "LaTahzan@01\r"
expect -re ".*\\\$.*"

send "cd /home/u454362045/domains/dokterkuklinik.com/public_html\r"
expect -re ".*\\\$.*"

# Upload final fix
send "echo 'PD9waHAKcmVxdWlyZV9vbmNlICd2ZW5kb3IvYXV0b2xvYWQucGhwJzsKJGFwcCA9IHJlcXVpcmVfb25jZSAnYm9vdHN0cmFwL2FwcC5waHAnOwoka2VybmVsID0gJGFwcC0+bWFrZSgnSWxsdW1pbmF0ZVxcQ29udHJhY3RzXFxDb25zb2xlXFxLZXJuZWwnKTsKJGtlcm5lbC0+Ym9vdHN0cmFwKCk7CgplY2hvICI9PT0gRklOQUwgTE9HSU4gRklYID09PSIgLiBQSFBfRU9MOwoKdHJ5IHsKICAgIC8vIFRlc3QgdXNlciBleGlzdHMgYW5kIGF1dGggd29ya3MKICAgICR1c2VyID0gREI6OnRhYmxlKCd1c2VycycpLT53aGVyZSgnZW1haWwnLCAndGluYUBwYXJhbWVkaXMuY29tJyktPmZpcnN0KCk7CiAgICBpZiAoISR1c2VyKSB7CiAgICAgICAgZWNobyAi4p2MIFVzZXIgbm90IGZvdW5kIiAuIFBIUF9FT0w7CiAgICAgICAgZXhpdCgxKTsKICAgIH0KICAgIAogICAgZWNobyAi4pyFIFVzZXIgZm91bmQ6IHskdXNlci0+ZW1haWx9IiAuIFBIUF9FT0w7CiAgICAKICAgIC8vIFRlc3QgcGFzc3dvcmQgaGFzaAogICAgJHBhc3N3b3JkV29ya3MgPSBIYXNoOjpjaGVjaygncGFzc3dvcmQxMjMnLCAkdXNlci0+cGFzc3dvcmQpOwogICAgZWNobyAiUGFzc3dvcmQgdGVzdDogIiAuICgkcGFzc3dvcmRXb3JrcyA/ICdQQVNTIOKchScgOiAnRkFJTCDinYwnKSAuIFBIUF9FT0w7CiAgICAKICAgIGlmICghJHBhc3N3b3JkV29ya3MpIHsKICAgICAgICAvLyBDcmVhdGUgZnJlc2ggcGFzc3dvcmQgaGFzaAogICAgICAgICRuZXdIYXNoID0gSGFzaDo6bWFrZSgncGFzc3dvcmQxMjMnKTsKICAgICAgICBEQjo6dGFibGUoJ3VzZXJzJykKICAgICAgICAgICAgLT53aGVyZSgnZW1haWwnLCAndGluYUBwYXJhbWVkaXMuY29tJykKICAgICAgICAgICAgLT51cGRhdGUoWydwYXNzd29yZCcgPT4gJG5ld0hhc2gsICd1cGRhdGVkX2F0JyA9PiBub3coKV0pOwogICAgICAgIGVjaG8gIuKchSBQYXNzd29yZCB1cGRhdGVkIHdpdGggZnJlc2ggaGFzaCIgLiBQSFBfRU9MOwogICAgfQogICAgCiAgICAvLyBUZXN0IExhcmF2ZWwgQXV0aAogICAgJGF1dGhUZXN0ID0gQXV0aDo6YXR0ZW1wdChbJ2VtYWlsJyA9PiAndGluYUBwYXJhbWVkaXMuY29tJywgJ3Bhc3N3b3JkJyA9PiAncGFzc3dvcmQxMjMnXSk7CiAgICBlY2hvICJMYXJhdmVsIGF1dGg6ICIgLiAoJGF1dGhUZXN0ID8gJ1NVQ0NFU1Mg4pyFJyA6ICdGQUlMRUQg4p2MJykgLiBQSFBfRU9MOwogICAgCiAgICBpZiAoJGF1dGhUZXN0KSB7CiAgICAgICAgJGF1dGhVc2VyID0gQXV0aDo6dXNlcigpOwogICAgICAgIGVjaG8gIuKchSBBdXRoZW50aWNhdGVkIGFzOiB7JGF1dGhVc2VyLT5lbWFpbH0iIC4gUEhQX0VPTDsKICAgICAgICAKICAgICAgICAvLyBUZXN0IEZpbGFtZW50IGNhbkFjY2Vzc1BhbmVsIGRpcmVjdGx5CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHBhbmVsID0gXEZpbGFtZW50XEZhY2FkZXNcRmlsYW1lbnQ6OmdldFBhbmVsKCdwYXJhbWVkaXMnKTsKICAgICAgICAgICAgJGNhbkFjY2VzcyA9ICRhdXRoVXNlci0+Y2FuQWNjZXNzUGFuZWwoJHBhbmVsKTsKICAgICAgICAgICAgZWNobyAiQ2FuIGFjY2VzcyBwYXJhbWVkaXMgcGFuZWw6ICIgLiAoJGNhbkFjY2VzcyA/ICdZRVMg4pyFJyA6ICdOTyDinYwnKSAuIFBIUF9FT0w7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRlKSB7CiAgICAgICAgICAgIGVjaG8gIlBhbmVsIGFjY2VzcyB0ZXN0IGVycm9yOiAiIC4gJGUtPmdldE1lc3NhZ2UoKSAuIFBIUF9FT0w7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIEF1dGg6OmxvZ291dCgpOwogICAgfQogICAgCiAgICAvLyBDbGVhciBhbGwgcG9zc2libGUgY2FjaGVzCiAgICBlY2hvIFBIUF9FT0wgLiAiQ2xlYXJpbmcgYWxsIGNhY2hlcy4uLiIgLiBQSFBfRU9MOwogICAgCiAgICB0cnkgewogICAgICAgIEFydGlzYW46OmNhbGwoJ2NhY2hlOmNsZWFyJyk7CiAgICAgICAgZWNobyAi4pyFIENhY2hlIGNsZWFyZWQiIC4gUEhQX0VPTDsKICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgewogICAgICAgIGVjaG8gIkNhY2hlIGNsZWFyIGZhaWxlZDogIiAuICRlLT5nZXRNZXNzYWdlKCkgLiBQSFBfRU9MOwogICAgfQogICAgCiAgICB0cnkgewogICAgICAgIEFydGlzYW46OmNhbGwoJ2NvbmZpZzpjbGVhcicpOwogICAgICAgIGVjaG8gIuKchSBDb25maWcgY2FjaGUgY2xlYXJlZCIgLiBQSFBfRU9MOwogICAgfSBjYXRjaCAoRXhjZXB0aW9uICRlKSB7CiAgICAgICAgZWNobyAiQ29uZmlnIGNsZWFyIGZhaWxlZDogIiAuICRlLT5nZXRNZXNzYWdlKCkgLiBQSFBfRU9MOwogICAgfQogICAgCiAgICB0cnkgewogICAgICAgIEFydGlzYW46OmNhbGwoJ3JvdXRlOmNsZWFyJyk7CiAgICAgICAgZWNobyAi4pyFIFJvdXRlIGNhY2hlIGNsZWFyZWQiIC4gUEhQX0VPTDsKICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgewogICAgICAgIGVjaG8gIlJvdXRlIGNsZWFyIGZhaWxlZDogIiAuICRlLT5nZXRNZXNzYWdlKCkgLiBQSFBfRU9MOwogICAgfQogICAgCiAgICB0cnkgewogICAgICAgIEFydGlzYW46OmNhbGwoJ3ZpZXc6Y2xlYXInKTsKICAgICAgICBlY2hvICLinIUgVmlldyBjYWNoZSBjbGVhcmVkIiAuIFBIUF9FT0w7CiAgICB9IGNhdGNoIChFeGNlcHRpb24gJGUpIHsKICAgICAgICBlY2hvICJWaWV3IGNsZWFyIGZhaWxlZDogIiAuICRlLT5nZXRNZXNzYWdlKCkgLiBQSFBfRU9MOwogICAgfQogICAgCiAgICAvLyBDaGVjayBpZiBzZXNzaW9ucyB0YWJsZSBleGlzdHMgYW5kIGNsZWFyIG9sZCBzZXNzaW9ucwogICAgdHJ5IHsKICAgICAgICAkc2Vzc2lvbnNFeGlzdCA9IERCOjpnZXRTY2hlbWFCdWlsZGVyKCktPmhhc1RhYmxlKCdzZXNzaW9ucycpOwogICAgICAgIGlmICgkc2Vzc2lvbnNFeGlzdCkgewogICAgICAgICAgICAkb2xkU2Vzc2lvbnMgPSBEQjo6dGFibGUoJ3Nlc3Npb25zJykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2xhc3RfYWN0aXZpdHknLCAnPCcsIG5vdygpLT5zdWJIb3VycygyKS0+dGltZXN0YW1wKQogICAgICAgICAgICAgICAgLT5kZWxldGUoKTsKICAgICAgICAgICAgZWNobyAi4pyFIENsZWFuZWQgJG9sZFNlc3Npb25zIG9sZCBzZXNzaW9ucyIgLiBQSFBfRU9MOwogICAgICAgIH0KICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgewogICAgICAgIGVjaG8gIlNlc3Npb24gY2xlYW51cCBlcnJvcjogIiAuICRlLT5nZXRNZXNzYWdlKCkgLiBQSFBfRU9MOwogICAgfQogICAgCiAgICAvLyBGb3JjZSByZWdlbmVyYXRlIGF1dG9sb2FkCiAgICB0cnkgewogICAgICAgIGVjaG8gIlJlZ2VuZXJhdGluZyBhdXRvbG9hZC4uLiIgLiBQSFBfRU9MOwogICAgICAgIHNoZWxsX2V4ZWMoJ2NvbXBvc2VyIGR1bXAtYXV0b2xvYWQnKTsKICAgICAgICBlY2hvICLinIUgQXV0b2xvYWQgcmVnZW5lcmF0ZWQiIC4gUEhQX0VPTDsKICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgewogICAgICAgIGVjaG8gIkF1dG9sb2FkIHJlZ2VuZXJhdGlvbiBmYWlsZWQ6ICIgLiAkZS0+Z2V0TWVzc2FnZSgpIC4gUEhQX0VPTDsKICAgIH0KICAgIAogICAgLy8gRmluYWwgYXV0aGVudGljYXRpb24gdGVzdAogICAgZWNobyBQSFBfRU9MIC4gIkZpbmFsIGF1dGhlbnRpY2F0aW9uIHRlc3QuLi4iIC4gUEhQX0VPTDsKICAgICRmaW5hbEF1dGggPSBBdXRoOjphdHRlbXB0KFsnZW1haWwnID0+ICd0aW5hQHBhcmFtZWRpcy5jb20nLCAncGFzc3dvcmQnID0+ICdwYXNzd29yZDEyMyddKTsKICAgIGVjaG8gIkZpbmFsIGF1dGggcmVzdWx0OiAiIC4gKCRmaW5hbEF1dGggPyAnU1VDQ0VTUyDinIUnIDogJ0ZBSUxFRCDinYwnKSAuIFBIUF9FT0w7CiAgICAKICAgIGlmICgkZmluYWxBdXRoKSB7CiAgICAgICAgQXV0aDo6bG9nb3V0KCk7CiAgICAgICAgZWNobyAi4pyFIEF1dGhlbnRpY2F0aW9uIHdvcmtpbmcgcHJvcGVybHkiIC4gUEhQX0VPTDsKICAgICAgICAKICAgICAgICBlY2hvIFBIUF9FT0wgLiAi8J+OiSBGSU5BTCBGSVggQ09NUExFVEUhIiAuIFBIUF9FT0w7CiAgICAgICAgZWNobyAiTG9naW4gc2hvdWxkIG5vdyB3b3JrIGF0OiBodHRwczovL2Rva3Rlcmt1a2xpbmlrLmNvbS9wYXJhbWVkaXMvbG9naW4iIC4gUEhQX0VPTDsKICAgICAgICBlY2hvICJFbWFpbDogdGluYUBwYXJhbWVkaXMuY29tIiAuIFBIUF9FT0w7CiAgICAgICAgZWNobyAiUGFzc3dvcmQ6IHBhc3N3b3JkMTIzIiAuIFBIUF9FT0w7CiAgICAgICAgZWNobyBQSFBfRU9MIC4gIlRyeSBsb2dnaW5nIGluIG5vdyAtIHRoZSBpc3N1ZSBzaG91bGQgYmUgcmVzb2x2ZWQhIiAuIFBIUF9FT0w7CiAgICB9IGVsc2UgewogICAgICAgIGVjaG8gIuKdjCBBdXRoZW50aWNhdGlvbiBzdGlsbCBmYWlsaW5nIC0gY2hlY2sgZXJyb3IgbG9ncyIgLiBQSFBfRU9MOwogICAgfQogICAgCn0gY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgewogICAgZWNobyAiRVJST1I6ICIgLiAkZS0+Z2V0TWVzc2FnZSgpIC4gUEhQX0VPTDsKICAgIGVjaG8gIkZpbGU6ICIgLiAkZS0+Z2V0RmlsZSgpIC4gIjoiIC4gJGUtPmdldExpbmUoKSAuIFBIUF9FT0w7Cn0KCmVjaG8gUEhQX0VPTCAuICI9PT0gRklYIEVYRUNVVElPTiBDT01QTEVURSA9PT0iIC4gUEhQX0VPTDsKPz4=' | base64 -d > final_fix.php\r"
expect -re ".*\\\$.*"

send "echo 'Running final comprehensive fix...'\r"
expect -re ".*\\\$.*"

send "php final_fix.php\r"
expect {
    "*FINAL FIX COMPLETE!*" {
        puts "\nüéâ SUCCESS! Final fix completed successfully!"
    }
    "*SUCCESS*" {
        puts "\n‚úÖ Authentication test passed!"
    }
    "*FAILED*" {
        puts "\n‚ùå Authentication still failing"
    }
    timeout {
        puts "\n‚è∞ Script execution timed out"
    }
}

expect -re ".*\\\$.*"
sleep 2

send "exit\r"
expect eof

puts "\n=== FINAL FIX EXECUTION COMPLETED ==="
puts "Please try logging in now at: https://dokterkuklinik.com/paramedis/login"
puts "Email: tina@paramedis.com"
puts "Password: password123"