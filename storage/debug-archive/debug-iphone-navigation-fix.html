<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>iPhone Navigation Fix Test - Dokterku Gaming Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Import our fixed navigation CSS */
        /* Medical RPG Navigation - iOS Safe Area & Touch Optimized */

        /* Root navigation container with safe area support */
        .medical-rpg-nav {
          /* Force system font without emoji fallback */
          font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
          
          /* Disable font substitution */
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          text-rendering: optimizeLegibility;
          
          /* Prevent iOS text adjustments */
          -webkit-text-size-adjust: 100%;
          -webkit-tap-highlight-color: transparent;
          
          /* Force GPU acceleration for better rendering */
          -webkit-transform: translateZ(0);
          transform: translateZ(0);
          will-change: transform;
          
          /* iOS Safari specific positioning fixes */
          -webkit-backface-visibility: hidden;
          backface-visibility: hidden;
          
          /* Safe area support for all iOS devices */
          padding-bottom: max(1rem, env(safe-area-inset-bottom));
          padding-left: max(1rem, env(safe-area-inset-left));
          padding-right: max(1rem, env(safe-area-inset-right));
          min-height: calc(5rem + env(safe-area-inset-bottom));
          
          /* Ensure consistent z-index behavior */
          z-index: 9999;
          position: fixed;
          
          /* Prevent scrolling issues on iPhone */
          overscroll-behavior: contain;
        }

        /* Icon container styling with enhanced touch support */
        .medical-rpg-nav-item {
          /* Prevent text selection */
          -webkit-user-select: none;
          -moz-user-select: none;
          user-select: none;
          
          /* Enhanced touch targets for better iOS accessibility */
          min-width: 48px;
          min-height: 48px;
          
          /* iOS-specific touch optimizations */
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: transparent;
          touch-action: manipulation;
          
          /* Center content */
          display: flex;
          align-items: center;
          justify-content: center;
          
          /* Ensure proper button behavior on iOS */
          cursor: pointer;
          outline: none;
          border: none;
          background: transparent;
          
          /* Better tap response on iOS */
          -webkit-user-drag: none;
          -webkit-user-modify: none;
          
          /* Force hardware acceleration for smooth animations */
          -webkit-transform: translateZ(0);
          transform: translateZ(0);
          will-change: transform;
        }

        /* iOS-specific viewport and layout fixes */
        @supports (-webkit-touch-callout: none) {
          /* iOS-specific navigation positioning */
          .medical-rpg-nav {
            /* Enhanced safe area support for all iPhone models */
            padding-bottom: max(1rem, env(safe-area-inset-bottom, 34px));
            /* iPhone 14 Pro and newer have larger safe areas */
            min-height: calc(5rem + env(safe-area-inset-bottom, 34px));
            
            /* Prevent iOS Safari bouncing */
            overscroll-behavior-y: none;
            -webkit-overflow-scrolling: touch;
            
            /* Force stacking context */
            isolation: isolate;
          }
          
          /* Enhanced touch targets for iPhone */
          .medical-rpg-nav-item {
            /* Minimum 44px touch target as per Apple HIG */
            min-width: 44px;
            min-height: 44px;
            
            /* Better touch feedback */
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            
            /* Prevent double-tap zoom */
            touch-action: manipulation;
            
            /* Enhanced hardware acceleration */
            -webkit-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
          }
        }

        /* iPhone 14 Pro and newer with Dynamic Island */
        @media screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) {
          .medical-rpg-nav {
            padding-bottom: max(1rem, env(safe-area-inset-bottom, 40px));
            min-height: calc(5rem + env(safe-area-inset-bottom, 40px));
          }
        }

        /* iPhone 14 Pro Max and newer */
        @media screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) {
          .medical-rpg-nav {
            padding-bottom: max(1rem, env(safe-area-inset-bottom, 40px));
            min-height: calc(5rem + env(safe-area-inset-bottom, 40px));
          }
        }

        /* Gaming gradient background */
        body {
            background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
            min-height: 100vh;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            /* Prevent iOS Safari bouncing */
            overscroll-behavior: contain;
            /* Ensure safe area coverage */
            padding: env(safe-area-inset-top, 0) env(safe-area-inset-right, 0) 0 env(safe-area-inset-left, 0);
        }
        
        /* Animation keyframes */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Content area with safe area support */
        .content-area {
            padding-bottom: max(8rem, calc(8rem + env(safe-area-inset-bottom)));
        }

        /* Visual debugging indicators */
        .debug-indicator {
            position: fixed;
            top: env(safe-area-inset-top, 20px);
            left: 10px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 10000;
            display: none;
        }

        /* Show debug on iPhone */
        @supports (-webkit-touch-callout: none) {
            .debug-indicator {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Debug indicator for iPhone -->
    <div class="debug-indicator">
        <div>iPhone Detected</div>
        <div id="safe-area-info">Safe Area: Loading...</div>
        <div id="viewport-info">Viewport: Loading...</div>
    </div>

    <div class="min-h-screen relative">
        <!-- Main Content Area with Safe Area Support -->
        <div class="content-area">
            <div class="max-w-sm mx-auto p-6">
                <h1 class="text-2xl font-bold text-center mb-8 bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                    🎮 iPhone Navigation Fix Test
                </h1>
                
                <div class="bg-white/5 backdrop-blur-2xl rounded-3xl p-6 border border-white/10 mb-6">
                    <h2 class="text-lg font-semibold mb-4">Navigation Test Status</h2>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span>Safe Area Support</span>
                            <span class="text-green-400" id="safe-area-status">✅ Active</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span>Touch Targets</span>
                            <span class="text-green-400" id="touch-status">✅ 44px+</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span>Fixed Positioning</span>
                            <span class="text-green-400" id="position-status">✅ Stable</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span>Clickability</span>
                            <span class="text-orange-400" id="click-status">🔄 Testing...</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white/5 backdrop-blur-2xl rounded-3xl p-6 border border-white/10 mb-6">
                    <h2 class="text-lg font-semibold mb-4">Doctor Profile</h2>
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-cyan-400 via-purple-500 to-pink-500 rounded-2xl flex items-center justify-center">
                            <span class="text-2xl">👑</span>
                        </div>
                        <div>
                            <h3 class="font-bold">Dr. iPhone Test</h3>
                            <p class="text-purple-200">Navigation Fix Validator</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white/5 backdrop-blur-2xl rounded-3xl p-6 border border-white/10 mb-6">
                    <h2 class="text-lg font-semibold mb-4">Test Instructions</h2>
                    <div class="space-y-2 text-sm">
                        <p>1. 📱 Scroll to the bottom to see navigation</p>
                        <p>2. 👆 Tap each navigation button</p>
                        <p>3. 🔄 Rotate device to test responsiveness</p>
                        <p>4. ⬇️ Check if navigation is above home indicator</p>
                    </div>
                </div>
                
                <!-- Extra content to ensure scrolling -->
                <div class="space-y-4 mt-8">
                    <div class="bg-white/5 backdrop-blur-2xl rounded-3xl p-4 border border-white/10">
                        <h3 class="font-semibold mb-2">Scroll Test Content</h3>
                        <div class="space-y-2">
                            <div class="flex items-center space-x-3 p-3 bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-2xl">
                                <span class="text-green-400">📱</span>
                                <div>
                                    <div class="font-medium">iPhone Compatibility</div>
                                    <div class="text-sm text-green-300">Safe Area Support Active</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/20 to-cyan-500/20 rounded-2xl">
                                <span class="text-blue-400">🎯</span>
                                <div>
                                    <div class="font-medium">Touch Targets</div>
                                    <div class="text-sm text-blue-300">44px Minimum Size</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- More content to test scrolling -->
                    <div class="bg-white/5 backdrop-blur-2xl rounded-3xl p-4 border border-white/10">
                        <h3 class="font-semibold mb-2">Viewport Information</h3>
                        <div class="text-sm space-y-1">
                            <div>Screen: <span id="screen-size">Loading...</span></div>
                            <div>Viewport: <span id="viewport-size">Loading...</span></div>
                            <div>Device Pixel Ratio: <span id="dpr">Loading...</span></div>
                            <div>User Agent: <span id="user-agent" class="text-xs">Loading...</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fixed Gaming Bottom Navigation - EXACTLY FROM OUR UPDATED COMPONENT -->
        <div 
            class="medical-rpg-nav fixed left-0 right-0 bg-gradient-to-t from-slate-800/90 via-purple-800/80 to-slate-700/90 backdrop-blur-3xl border-t border-purple-400/20 z-50 rounded-t-3xl shadow-2xl"
            style="
                bottom: 0;
                padding-bottom: max(1rem, env(safe-area-inset-bottom));
                padding-left: max(1rem, env(safe-area-inset-left));
                padding-right: max(1rem, env(safe-area-inset-right));
                padding-top: 1rem;
                min-height: calc(5rem + env(safe-area-inset-bottom));
                -webkit-user-select: none;
                -webkit-touch-callout: none;
                -webkit-tap-highlight-color: transparent;
                -webkit-transform: translateZ(0);
                transform: translateZ(0);
                will-change: transform;
                -webkit-backface-visibility: hidden;
                backface-visibility: hidden;
            "
        >
            <div class="flex justify-between items-center max-w-sm mx-auto">
            
            <!-- Home - Active State -->
            <button 
                class="medical-rpg-nav-item relative group transition-all duration-500 ease-out"
                style="
                    min-width: 48px;
                    min-height: 48px;
                    -webkit-user-select: none;
                    -webkit-touch-callout: none;
                    -webkit-tap-highlight-color: transparent;
                    touch-action: manipulation;
                "
                onclick="handleNavClick('home')"
                aria-label="Navigate to Home"
            >
              <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-gradient-to-r from-cyan-400 to-purple-400 rounded-full animate-pulse"></div>
              <div class="absolute inset-0 bg-gradient-to-r from-cyan-500/30 to-purple-500/30 rounded-2xl blur-lg scale-150 opacity-60"></div>
              <div class="relative bg-gradient-to-r from-cyan-500/40 to-purple-500/40 backdrop-blur-xl border border-cyan-300/30 p-3 rounded-2xl shadow-2xl shadow-purple-500/30 scale-115">
                <div class="flex flex-col items-center">
                  <span class="text-white mb-1">👑</span>
                  <span class="text-xs text-white font-medium">Home</span>
                </div>
              </div>
            </button>
            
            <!-- Calendar - Inactive -->
            <button 
                class="medical-rpg-nav-item relative group transition-all duration-500 ease-out"
                style="
                    min-width: 48px;
                    min-height: 48px;
                    -webkit-user-select: none;
                    -webkit-touch-callout: none;
                    -webkit-tap-highlight-color: transparent;
                    touch-action: manipulation;
                "
                onclick="handleNavClick('missions')"
                aria-label="Navigate to Missions"
            >
              <div class="absolute inset-0 bg-gradient-to-br from-blue-500/0 to-blue-500/20 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              <div class="relative p-3 rounded-2xl transition-all duration-500 group-hover:bg-purple-600/20 group-hover:scale-110 group-hover:shadow-lg group-hover:shadow-blue-500/20">
                <div class="flex flex-col items-center">
                  <span class="text-gray-400 group-hover:text-blue-400 mb-1 transition-colors duration-500">📅</span>
                  <span class="text-xs text-gray-400 group-hover:text-blue-400 font-medium transition-colors duration-500">Missions</span>
                </div>
              </div>
            </button>
            
            <!-- Shield - Guardian -->
            <button 
                class="medical-rpg-nav-item relative group transition-all duration-500 ease-out"
                style="
                    min-width: 48px;
                    min-height: 48px;
                    -webkit-user-select: none;
                    -webkit-touch-callout: none;
                    -webkit-tap-highlight-color: transparent;
                    touch-action: manipulation;
                "
                onclick="handleNavClick('guardian')"
                aria-label="Navigate to Guardian"
            >
              <div class="absolute inset-0 bg-gradient-to-br from-green-500/0 to-green-500/20 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              <div class="relative p-3 rounded-2xl transition-all duration-500 group-hover:bg-purple-600/20 group-hover:scale-110 group-hover:shadow-lg group-hover:shadow-green-500/20">
                <div class="flex flex-col items-center">
                  <span class="text-gray-400 group-hover:text-green-400 mb-1 transition-colors duration-500">🛡️</span>
                  <span class="text-xs text-gray-400 group-hover:text-green-400 font-medium transition-colors duration-500">Guardian</span>
                </div>
              </div>
            </button>
            
            <!-- Star - Rewards -->
            <button 
                class="medical-rpg-nav-item relative group transition-all duration-500 ease-out"
                style="
                    min-width: 48px;
                    min-height: 48px;
                    -webkit-user-select: none;
                    -webkit-touch-callout: none;
                    -webkit-tap-highlight-color: transparent;
                    touch-action: manipulation;
                "
                onclick="handleNavClick('rewards')"
                aria-label="Navigate to Rewards"
            >
              <div class="absolute inset-0 bg-gradient-to-br from-yellow-500/0 to-yellow-500/20 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              <div class="relative p-3 rounded-2xl transition-all duration-500 group-hover:bg-purple-600/20 group-hover:scale-110 group-hover:shadow-lg group-hover:shadow-yellow-500/20">
                <div class="flex flex-col items-center">
                  <span class="text-gray-400 group-hover:text-yellow-400 mb-1 transition-colors duration-500">⭐</span>
                  <span class="text-xs text-gray-400 group-hover:text-yellow-400 font-medium transition-colors duration-500">Rewards</span>
                </div>
              </div>
            </button>
            
            <!-- Brain - Profile -->
            <button 
                class="medical-rpg-nav-item relative group transition-all duration-500 ease-out"
                style="
                    min-width: 48px;
                    min-height: 48px;
                    -webkit-user-select: none;
                    -webkit-touch-callout: none;
                    -webkit-tap-highlight-color: transparent;
                    touch-action: manipulation;
                "
                onclick="handleNavClick('profile')"
                aria-label="Navigate to Profile"
            >
              <div class="absolute inset-0 bg-gradient-to-br from-purple-500/0 to-purple-500/20 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              <div class="relative p-3 rounded-2xl transition-all duration-500 group-hover:bg-purple-600/20 group-hover:scale-110 group-hover:shadow-lg group-hover:shadow-purple-500/20">
                <div class="flex flex-col items-center">
                  <span class="text-gray-400 group-hover:text-purple-400 mb-1 transition-colors duration-500">🧠</span>
                  <span class="text-xs text-gray-400 group-hover:text-purple-400 font-medium transition-colors duration-500">Profile</span>
                </div>
              </div>
            </button>
            
            </div>
        </div>

        <!-- Gaming Home Indicator with Safe Area Support -->
        <div 
            class="fixed left-1/2 transform -translate-x-1/2 w-32 h-1 bg-gradient-to-r from-transparent via-purple-400/60 to-transparent rounded-full shadow-lg shadow-purple-400/30 z-40"
            style="bottom: max(0.5rem, env(safe-area-inset-bottom));"
        ></div>
    </div>

    <script>
        console.log('🎮 iPhone Navigation Fix Test Loaded');
        
        let clickCount = 0;
        
        // Handle navigation clicks
        function handleNavClick(section) {
            clickCount++;
            console.log(`🎯 Navigation clicked: ${section} (${clickCount} total clicks)`);
            
            // Update click status
            const clickStatus = document.getElementById('click-status');
            if (clickStatus) {
                clickStatus.innerHTML = `✅ ${clickCount} clicks`;
                clickStatus.className = 'text-green-400';
            }
            
            // Visual feedback
            const activeButtons = document.querySelectorAll('.medical-rpg-nav-item');
            activeButtons.forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // Show success message
            showToast(`Navigated to ${section}`, 'success');
        }
        
        // Show toast messages
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${type === 'success' ? '#10b981' : '#3b82f6'};
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                z-index: 10001;
                font-weight: bold;
                animation: fadeInOut 2s ease-in-out forwards;
            `;
            
            // Add animation keyframes
            if (!document.getElementById('toast-styles')) {
                const style = document.createElement('style');
                style.id = 'toast-styles';
                style.textContent = `
                    @keyframes fadeInOut {
                        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                        20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                        80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 2000);
        }
        
        // Update device information
        function updateDeviceInfo() {
            // Safe area information
            const safeAreaInfo = document.getElementById('safe-area-info');
            if (safeAreaInfo) {
                safeAreaInfo.textContent = `Safe Area: ${CSS.supports('padding', 'env(safe-area-inset-bottom)') ? 'Supported' : 'Not Supported'}`;
            }
            
            // Viewport information
            const viewportInfo = document.getElementById('viewport-info');
            if (viewportInfo) {
                viewportInfo.textContent = `${window.innerWidth}x${window.innerHeight}`;
            }
            
            // Screen size
            const screenSize = document.getElementById('screen-size');
            if (screenSize) {
                screenSize.textContent = `${screen.width}x${screen.height}`;
            }
            
            // Viewport size
            const viewportSize = document.getElementById('viewport-size');
            if (viewportSize) {
                viewportSize.textContent = `${window.innerWidth}x${window.innerHeight}`;
            }
            
            // Device pixel ratio
            const dpr = document.getElementById('dpr');
            if (dpr) {
                dpr.textContent = window.devicePixelRatio || 1;
            }
            
            // User agent
            const userAgent = document.getElementById('user-agent');
            if (userAgent) {
                userAgent.textContent = navigator.userAgent.split(' ').slice(-2).join(' ');
            }
        }
        
        // Test navigation visibility and positioning
        function testNavigation() {
            const nav = document.querySelector('.medical-rpg-nav');
            const indicator = document.querySelector('[style*="safe-area-inset-bottom"]');
            
            console.log('Navigation element:', nav);
            console.log('Home indicator:', indicator);
            
            if (nav) {
                console.log('✅ Bottom navigation found');
                const rect = nav.getBoundingClientRect();
                console.log('Navigation position:', {
                    top: rect.top,
                    bottom: rect.bottom,
                    height: rect.height,
                    bottom_distance: window.innerHeight - rect.bottom
                });
                
                // Check if navigation is properly positioned
                const isProperlyPositioned = rect.bottom <= window.innerHeight && rect.bottom > window.innerHeight - 200;
                console.log('Properly positioned:', isProperlyPositioned);
                
                if (isProperlyPositioned) {
                    document.getElementById('position-status').innerHTML = '✅ Perfect';
                    document.getElementById('position-status').className = 'text-green-400';
                } else {
                    document.getElementById('position-status').innerHTML = '❌ Issues';
                    document.getElementById('position-status').className = 'text-red-400';
                }
            } else {
                console.log('❌ Bottom navigation NOT found');
                document.getElementById('position-status').innerHTML = '❌ Missing';
                document.getElementById('position-status').className = 'text-red-400';
            }
            
            // Test touch targets
            const touchTargets = document.querySelectorAll('.medical-rpg-nav-item');
            let minSize = Infinity;
            touchTargets.forEach(target => {
                const rect = target.getBoundingClientRect();
                minSize = Math.min(minSize, rect.width, rect.height);
            });
            
            if (minSize >= 44) {
                document.getElementById('touch-status').innerHTML = `✅ ${Math.round(minSize)}px`;
                document.getElementById('touch-status').className = 'text-green-400';
            } else {
                document.getElementById('touch-status').innerHTML = `❌ ${Math.round(minSize)}px`;
                document.getElementById('touch-status').className = 'text-red-400';
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateDeviceInfo();
            testNavigation();
        });
        
        // Update on resize
        window.addEventListener('resize', () => {
            setTimeout(() => {
                updateDeviceInfo();
                testNavigation();
            }, 100);
        });
        
        // Monitor viewport changes
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                updateDeviceInfo();
                testNavigation();
                showToast('Orientation changed - testing navigation...', 'info');
            }, 500);
        });
        
        // Log initial state
        console.log('Device Info:', {
            userAgent: navigator.userAgent,
            viewport: `${window.innerWidth}x${window.innerHeight}`,
            screen: `${screen.width}x${screen.height}`,
            devicePixelRatio: window.devicePixelRatio,
            isIOS: /iPad|iPhone|iPod/.test(navigator.userAgent),
            safeAreaSupport: CSS.supports('padding', 'env(safe-area-inset-bottom)')
        });
        
        // Test message after 2 seconds
        setTimeout(() => {
            showToast('Tap navigation buttons to test!', 'info');
        }, 2000);
    </script>
</body>
</html>