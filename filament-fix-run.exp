#!/usr/bin/expect -f

set timeout 60

spawn ssh -p 65002 u454362045@153.92.8.132
expect "password:"
send "LaTahzan@01\r"
expect -re ".*\\\$.*"

send "cd /home/u454362045/domains/dokterkuklinik.com/public_html\r"
expect -re ".*\\\$.*"

# Upload and run Filament fix
send "echo 'PD9waHAKcmVxdWlyZV9vbmNlICd2ZW5kb3IvYXV0b2xvYWQucGhwJzsKJGFwcCA9IHJlcXVpcmVfb25jZSAnYm9vdHN0cmFwL2FwcC5waHAnOwoka2VybmVsID0gJGFwcC0+bWFrZSgnSWxsdW1pbmF0ZVxcQ29udHJhY3RzXFxDb25zb2xlXFxLZXJuZWwnKTsKJGtlcm5lbC0+Ym9vdHN0cmFwKCk7CgplY2hvICI9PT0gRklMQU1FTlQgQVVUSEVOVElDQVRJT04gRklYID09PSIgLiBQSFBfRU9MOwoKdHJ5IHsKICAgIC8vIENoZWNrIGN1cnJlbnQgRmlsYW1lbnQgY29uZmlndXJhdGlvbgogICAgZWNobyAiQ2hlY2tpbmcgRmlsYW1lbnQgY29uZmlndXJhdGlvbi4uLiIgLiBQSFBfRU9MOwogICAgCiAgICAvLyBDaGVjayBpZiB1c2VyIG1vZGVsIGhhcyBwcm9wZXIgbWV0aG9kcwogICAgJHVzZXIgPSBEQjo6dGFibGUoJ3VzZXJzJyktPndoZXJlKCdlbWFpbCcsICd0aW5hQHBhcmFtZWRpcy5jb20nKS0+Zmlyc3QoKTsKICAgIGlmICgkdXNlcikgewogICAgICAgIGVjaG8gIuKchSBVc2VyIGZvdW5kIGluIGRhdGFiYXNlIiAuIFBIUF9FT0w7CiAgICAgICAgCiAgICAgICAgLy8gQ3JlYXRlIFVzZXIgbW9kZWwgaW5zdGFuY2UgdG8gdGVzdCBtZXRob2RzCiAgICAgICAgJHVzZXJNb2RlbCA9IG5ldyBBcHBcTW9kZWxzXFVzZXIoKTsKICAgICAgICAkdXNlckluc3RhbmNlID0gJHVzZXJNb2RlbC0+d2hlcmUoJ2VtYWlsJywgJ3RpbmFAcGFyYW1lZGlzLmNvbScpLT5maXJzdCgpOwogICAgICAgIAogICAgICAgIGlmICgkdXNlckluc3RhbmNlKSB7CiAgICAgICAgICAgIGVjaG8gIuKchSBVc2VyIG1vZGVsIGluc3RhbmNlIGNyZWF0ZWQiIC4gUEhQX0VPTDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFRlc3QgaGFzUm9sZSBtZXRob2QgaWYgaXQgZXhpc3RzCiAgICAgICAgICAgIGlmIChtZXRob2RfZXhpc3RzKCR1c2VySW5zdGFuY2UsICdoYXNSb2xlJykpIHsKICAgICAgICAgICAgICAgICRoYXNQYXJhbWVkaXNSb2xlID0gJHVzZXJJbnN0YW5jZS0+aGFzUm9sZSgncGFyYW1lZGlzJyk7CiAgICAgICAgICAgICAgICBlY2hvICJSb2xlIGNoZWNrIChoYXNSb2xlKTogIiAuICgkaGFzUGFyYW1lZGlzUm9sZSA/ICdQQVNTIOKchScgOiAnRkFJTCDinYwnKSAuIFBIUF9FT0w7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlY2hvICLimqDvuI8gIGhhc1JvbGUgbWV0aG9kIG5vdCBmb3VuZCwgdXNpbmcgcm9sZV9pZCBjaGVjayIgLiBQSFBfRU9MOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDaGVjayByb2xlIHJlbGF0aW9uc2hpcAogICAgICAgICAgICBpZiAoJHVzZXJJbnN0YW5jZS0+cm9sZSkgewogICAgICAgICAgICAgICAgZWNobyAi4pyFIFJvbGUgcmVsYXRpb25zaGlwIHdvcmtzOiB7JHVzZXJJbnN0YW5jZS0+cm9sZS0+bmFtZX0iIC4gUEhQX0VPTDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVjaG8gIuKdjCBSb2xlIHJlbGF0aW9uc2hpcCBicm9rZW4iIC4gUEhQX0VPTDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gVGVzdCBGaWxhbWVudCBBdXRoIHNwZWNpZmljYWxseQogICAgZWNobyBQSFBfRU9MIC4gIlRlc3RpbmcgRmlsYW1lbnQtc3BlY2lmaWMgYXV0aGVudGljYXRpb24uLi4iIC4gUEhQX0VPTDsKICAgIAogICAgLy8gQ2xlYXIgYW55IGV4aXN0aW5nIGF1dGgKICAgIEF1dGg6OmxvZ291dCgpOwogICAgCiAgICAvLyBUZXN0IHdpdGggd2ViIGd1YXJkIHNwZWNpZmljYWxseQogICAgJHdlYkF1dGggPSBBdXRoOjpndWFyZCgnd2ViJyktPmF0dGVtcHQoWydlbWFpbCcgPT4gJ3RpbmFAcGFyYW1lZGlzLmNvbScsICdwYXNzd29yZCcgPT4gJ3Bhc3N3b3JkMTIzJ10pOwogICAgZWNobyAiV2ViIGd1YXJkIGF1dGg6ICIgLiAoJHdlYkF1dGggPyAnU1VDQ0VTUyDinIUnIDogJ0ZBSUxFRCDinYwnKSAuIFBIUF9FT0w7CiAgICAKICAgIGlmICgkd2ViQXV0aCkgewogICAgICAgICRhdXRoVXNlciA9IEF1dGg6Omd1YXJkKCd3ZWInKS0+dXNlcigpOwogICAgICAgIGVjaG8gIkF1dGhlbnRpY2F0ZWQgdXNlcjogeyRhdXRoVXNlci0+ZW1haWx9IiAuIFBIUF9FT0w7CiAgICAgICAgCiAgICAgICAgLy8gVGVzdCBjYW5BY2Nlc3NQYW5lbCBtZXRob2QgaWYgaXQgZXhpc3RzCiAgICAgICAgJHBhcmFtZWRpc1BhbmVsID0gYXBwKCdBcHBcXFByb3ZpZGVyc1xcRmlsYW1lbnRcXFBhcmFtZWRpc1BhbmVsUHJvdmlkZXInKTsKICAgICAgICBpZiAobWV0aG9kX2V4aXN0cygkcGFyYW1lZGlzUGFuZWwsICdjYW5BY2Nlc3NQYW5lbCcpKSB7CiAgICAgICAgICAgICRjYW5BY2Nlc3MgPSAkcGFyYW1lZGlzUGFuZWwtPmNhbkFjY2Vzc1BhbmVsKCk7CiAgICAgICAgICAgIGVjaG8gIkNhbiBhY2Nlc3MgcGFyYW1lZGlzIHBhbmVsOiAiIC4gKCRjYW5BY2Nlc3MgPyAnWUVTIOKchScgOiAnTk8g4p2MJykgLiBQSFBfRU9MOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBBdXRoOjpsb2dvdXQoKTsKICAgIH0KICAgIAogICAgLy8gQ2hlY2sgcGFzc3dvcmQgaGFzaCBmb3JtYXQKICAgIGVjaG8gUEhQX0VPTCAuICJDaGVja2luZyBwYXNzd29yZCBoYXNoIGZvcm1hdC4uLiIgLiBQSFBfRU9MOwogICAgJHBhc3N3b3JkSGFzaCA9ICR1c2VyLT5wYXNzd29yZDsKICAgIGVjaG8gIkhhc2ggYWxnb3JpdGhtOiAiIC4gKHN0cl9zdGFydHNfd2l0aCgkcGFzc3dvcmRIYXNoLCAnJDJ5JCcpID8gJ2JjcnlwdCDinIUnIDogJ3Vua25vd24g4p2MJykgLiBQSFBfRU9MOwogICAgCiAgICAvLyBUZXN0IHBhc3N3b3JkIHZlcmlmaWNhdGlvbiBhZ2FpbiB3aXRoIGZyZXNoIGhhc2gKICAgIGVjaG8gIkNyZWF0aW5nIGZyZXNoIHBhc3N3b3JkIGhhc2guLi4iIC4gUEhQX0VPTDsKICAgICRmcmVzaEhhc2ggPSBIYXNoOjptYWtlKCdwYXNzd29yZDEyMycpOwogICAgJGZyZXNoVmVyaWZ5ID0gSGFzaDo6Y2hlY2soJ3Bhc3N3b3JkMTIzJywgJGZyZXNoSGFzaCk7CiAgICBlY2hvICJGcmVzaCBoYXNoIHZlcmlmaWNhdGlvbjogIiAuICgkZnJlc2hWZXJpZnkgPyAnUEFTUyDinIUnIDogJ0ZBSUwg4p2MJykgLiBQSFBfRU9MOwogICAgCiAgICAvLyBVcGRhdGUgdXNlciB3aXRoIGZyZXNoIGhhc2ggaWYgbmVlZGVkCiAgICBpZiAoJGZyZXNoVmVyaWZ5KSB7CiAgICAgICAgREI6OnRhYmxlKCd1c2VycycpCiAgICAgICAgICAgIC0+d2hlcmUoJ2VtYWlsJywgJ3RpbmFAcGFyYW1lZGlzLmNvbScpCiAgICAgICAgICAgIC0+dXBkYXRlKFsncGFzc3dvcmQnID0+ICRmcmVzaEhhc2gsICd1cGRhdGVkX2F0JyA9PiBub3coKV0pOwogICAgICAgIGVjaG8gIuKchSBVcGRhdGVkIHVzZXIgd2l0aCBmcmVzaCBwYXNzd29yZCBoYXNoIiAuIFBIUF9FT0w7CiAgICAgICAgCiAgICAgICAgLy8gVGVzdCBhdXRoIGFnYWluIHdpdGggZnJlc2ggaGFzaAogICAgICAgICRmaW5hbEF1dGggPSBBdXRoOjphdHRlbXB0KFsnZW1haWwnID0+ICd0aW5hQHBhcmFtZWRpcy5jb20nLCAncGFzc3dvcmQnID0+ICdwYXNzd29yZDEyMyddKTsKICAgICAgICBlY2hvICJGaW5hbCBhdXRoIHRlc3Q6ICIgLiAoJGZpbmFsQXV0aCA/ICdTVUNDRVNTIOKchScgOiAnRkFJTEVEIOKdjCcpIC4gUEhQX0VPTDsKICAgICAgICBpZiAoJGZpbmFsQXV0aCkgQXV0aDo6bG9nb3V0KCk7CiAgICB9CiAgICAKICAgIC8vIENsZWFyIGFsbCBjYWNoZXMgYWdncmVzc2l2ZWx5CiAgICBlY2hvIFBIUF9FT0wgLiAiQ2xlYXJpbmcgYWxsIGNhY2hlcy4uLiIgLiBQSFBfRU9MOwogICAgQXJ0aXNhbjo6Y2FsbCgnY2FjaGU6Y2xlYXInKTsKICAgIEFydGlzYW46OmNhbGwoJ2NvbmZpZzpjbGVhcicpOwogICAgQXJ0aXNhbjo6Y2FsbCgncm91dGU6Y2xlYXInKTsKICAgIEFydGlzYW46OmNhbGwoJ3ZpZXc6Y2xlYXInKTsKICAgIAogICAgLy8gVHJ5IHRvIGNsZWFyIHNlc3Npb24gY2FjaGUgaWYgZXhpc3RzCiAgICB0cnkgewogICAgICAgIEFydGlzYW46OmNhbGwoJ3Nlc3Npb246Y2xlYXInKTsKICAgICAgICBlY2hvICLinIUgU2Vzc2lvbiBjYWNoZSBjbGVhcmVkIiAuIFBIUF9FT0w7CiAgICB9IGNhdGNoIChFeGNlcHRpb24gJGUpIHsKICAgICAgICBlY2hvICLihLnvuI8gIFNlc3Npb24gY2xlYXIgbm90IGF2YWlsYWJsZSIgLiBQSFBfRU9MOwogICAgfQogICAgCiAgICBlY2hvIFBIUF9FT0wgLiAiPT09IEZJTEFNRU5UIEZJWCBDT01QTEVURSA9PT0iIC4gUEhQX0VPTDsKICAgIGVjaG8gIlRyeSBsb2dpbiBhZ2FpbiBhdDogaHR0cHM6Ly9kb2t0ZXJrdWtsaW5pay5jb20vcGFyYW1lZGlzL2xvZ2luIiAuIFBIUF9FT0w7CiAgICBlY2hvICJFbWFpbDogdGluYUBwYXJhbWVkaXMuY29tIiAuIFBIUF9FT0w7CiAgICBlY2hvICJQYXNzd29yZDogcGFzc3dvcmQxMjMiIC4gUEhQX0VPTDsKICAgIAp9IGNhdGNoIChFeGNlcHRpb24gJGUpIHsKICAgIGVjaG8gIkVSUk9SOiAiIC4gJGUtPmdldE1lc3NhZ2UoKSAuIFBIUF9FT0w7CiAgICBlY2hvICJGaWxlOiAiIC4gJGUtPmdldEZpbGUoKSAuICI6IiAuICRlLT5nZXRMaW5lKCkgLiBQSFBfRU9MOwp9Cj8+' | base64 -d > filament_fix.php\r"
expect -re ".*\\\$.*"

send "php filament_fix.php\r"
expect -re ".*\\\$.*"
sleep 3

send "exit\r"
expect eof