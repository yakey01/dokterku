#!/usr/bin/expect -f

set timeout 60

spawn ssh -p 65002 u454362045@153.92.8.132
expect "password:"
send "LaTahzan@01\r"
expect -re ".*\\\$.*"

send "cd /home/u454362045/domains/dokterkuklinik.com/public_html\r"
expect -re ".*\\\$.*"

# Upload debug script
send "echo 'PD9waHAKcmVxdWlyZV9vbmNlICd2ZW5kb3IvYXV0b2xvYWQucGhwJzsKJGFwcCA9IHJlcXVpcmVfb25jZSAnYm9vdHN0cmFwL2FwcC5waHAnOwoka2VybmVsID0gJGFwcC0+bWFrZSgnSWxsdW1pbmF0ZVxcQ29udHJhY3RzXFxDb25zb2xlXFxLZXJuZWwnKTsKJGtlcm5lbC0+Ym9vdHN0cmFwKCk7CgplY2hvICI9PT0gREVCVUcgQVVUSEVOVElDQVRJT04gPT09IiAuIFBIUF9FT0w7Cgp0cnkgewogICAgLy8gQ2hlY2sgaWYgdXNlciBleGlzdHMKICAgICR1c2VyID0gREI6OnRhYmxlKCd1c2VycycpLT53aGVyZSgnZW1haWwnLCAndGluYUBwYXJhbWVkaXMuY29tJyktPmZpcnN0KCk7CiAgICBpZiAoJHVzZXIpIHsKICAgICAgICBlY2hvICLinIUgVXNlciBleGlzdHM6IiAuIFBIUF9FT0w7CiAgICAgICAgZWNobyAiICAgSUQ6IHskdXNlci0+aWR9IiAuIFBIUF9FT0w7CiAgICAgICAgZWNobyAiICAgTmFtZTogeyR1c2VyLT5uYW1lfSIgLiBQSFBfRU9MOwogICAgICAgIGVjaG8gIiAgIEVtYWlsOiB7JHVzZXItPmVtYWlsfSIgLiBQSFBfRU9MOwogICAgICAgIGVjaG8gIiAgIFJvbGUgSUQ6IHskdXNlci0+cm9sZV9pZH0iIC4gUEhQX0VPTDsKICAgICAgICBlY2hvICIgICBFbWFpbCB2ZXJpZmllZDogIiAuICgkdXNlci0+ZW1haWxfdmVyaWZpZWRfYXQgPyAnWUVTJyA6ICdOTycpIC4gUEhQX0VPTDsKICAgICAgICBlY2hvICIgICBQYXNzd29yZCBoYXNoIHN0YXJ0cyB3aXRoOiAiIC4gc3Vic3RyKCR1c2VyLT5wYXNzd29yZCwgMCwgMTApIC4gIi4uLiIgLiBQSFBfRU9MOwogICAgICAgIAogICAgICAgIC8vIENoZWNrIHJvbGUKICAgICAgICAkcm9sZSA9IERCOjp0YWJsZSgncm9sZXMnKS0+d2hlcmUoJ2lkJywgJHVzZXItPnJvbGVfaWQpLT5maXJzdCgpOwogICAgICAgIGlmICgkcm9sZSkgewogICAgICAgICAgICBlY2hvICLinIUgUm9sZTogeyRyb2xlLT5uYW1lfSAoSUQ6IHskcm9sZS0+aWR9KSIgLiBQSFBfRU9MOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVjaG8gIuKdjCBSb2xlIG5vdCBmb3VuZCBmb3Igcm9sZV9pZDogeyR1c2VyLT5yb2xlX2lkfSIgLiBQSFBfRU9MOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBUZXN0IHBhc3N3b3JkIHZlcmlmaWNhdGlvbgogICAgICAgICRwYXNzd29yZENoZWNrID0gSGFzaDo6Y2hlY2soJ3Bhc3N3b3JkMTIzJywgJHVzZXItPnBhc3N3b3JkKTsKICAgICAgICBlY2hvICJQYXNzd29yZCB2ZXJpZmljYXRpb246ICIgLiAoJHBhc3N3b3JkQ2hlY2sgPyAnUEFTUyDinIUnIDogJ0ZBSUwg4p2MJykgLiBQSFBfRU9MOwogICAgICAgIAogICAgICAgIGlmICghJHBhc3N3b3JkQ2hlY2spIHsKICAgICAgICAgICAgZWNobyAi4p2MIFBhc3N3b3JkIGhhc2ggdmVyaWZpY2F0aW9uIGZhaWxlZCEiIC4gUEhQX0VPTDsKICAgICAgICAgICAgZWNobyAiQ3JlYXRpbmcgbmV3IGhhc2ggZm9yIGNvbXBhcmlzb24uLi4iIC4gUEhQX0VPTDsKICAgICAgICAgICAgJG5ld0hhc2ggPSBIYXNoOjptYWtlKCdwYXNzd29yZDEyMycpOwogICAgICAgICAgICBlY2hvICJOZXcgaGFzaCBzdGFydHMgd2l0aDogIiAuIHN1YnN0cigkbmV3SGFzaCwgMCwgMTApIC4gIi4uLiIgLiBQSFBfRU9MOwogICAgICAgICAgICAkbmV3Q2hlY2sgPSBIYXNoOjpjaGVjaygncGFzc3dvcmQxMjMnLCAkbmV3SGFzaCk7CiAgICAgICAgICAgIGVjaG8gIk5ldyBoYXNoIHZlcmlmaWNhdGlvbjogIiAuICgkbmV3Q2hlY2sgPyAnUEFTUycgOiAnRkFJTCcpIC4gUEhQX0VPTDsKICAgICAgICB9CiAgICAgICAgCiAgICB9IGVsc2UgewogICAgICAgIGVjaG8gIuKdjCBVc2VyIHdpdGggZW1haWwgJ3RpbmFAcGFyYW1lZGlzLmNvbScgbm90IGZvdW5kISIgLiBQSFBfRU9MOwogICAgfQogICAgCiAgICAvLyBUZXN0IExhcmF2ZWwgQXV0aCBhdHRlbXB0CiAgICBlY2hvIFBIUF9FT0wgLiAiVGVzdGluZyBMYXJhdmVsIEF1dGg6OmF0dGVtcHQoKS4uLiIgLiBQSFBfRU9MOwogICAgJGF1dGhSZXN1bHQgPSBBdXRoOjphdHRlbXB0KFsnZW1haWwnID0+ICd0aW5hQHBhcmFtZWRpcy5jb20nLCAncGFzc3dvcmQnID0+ICdwYXNzd29yZDEyMyddKTsKICAgIGVjaG8gIkF1dGg6OmF0dGVtcHQgcmVzdWx0OiAiIC4gKCRhdXRoUmVzdWx0ID8gJ1NVQ0NFU1Mg4pyFJyA6ICdGQUlMRUQg4p2MJykgLiBQSFBfRU9MOwogICAgCiAgICBpZiAoJGF1dGhSZXN1bHQpIHsKICAgICAgICAkYXV0aFVzZXIgPSBBdXRoOjp1c2VyKCk7CiAgICAgICAgZWNobyAiQXV0aGVudGljYXRlZCB1c2VyOiB7JGF1dGhVc2VyLT5lbWFpbH0iIC4gUEhQX0VPTDsKICAgICAgICBBdXRoOjpsb2dvdXQoKTsKICAgIH0gZWxzZSB7CiAgICAgICAgZWNobyAi4p2MIExhcmF2ZWwgYXV0aGVudGljYXRpb24gZmFpbGVkIiAuIFBIUF9FT0w7CiAgICAgICAgCiAgICAgICAgLy8gQ2hlY2sgYXV0aCBjb25maWd1cmF0aW9uCiAgICAgICAgZWNobyBQSFBfRU9MIC4gIkNoZWNraW5nIGF1dGggY29uZmlndXJhdGlvbi4uLiIgLiBQSFBfRU9MOwogICAgICAgIGVjaG8gIkF1dGggZ3VhcmQ6ICIgLiBjb25maWcoJ2F1dGguZGVmYXVsdHMuZ3VhcmQnKSAuIFBIUF9FT0w7CiAgICAgICAgZWNobyAiQXV0aCBwcm92aWRlcjogIiAuIGNvbmZpZygnYXV0aC5kZWZhdWx0cy5wcm92aWRlcicpIC4gUEhQX0VPTDsKICAgICAgICBlY2hvICJVc2VyIG1vZGVsOiAiIC4gY29uZmlnKCdhdXRoLnByb3ZpZGVycy51c2Vycy5tb2RlbCcpIC4gUEhQX0VPTDsKICAgICAgICAKICAgICAgICAvLyBDaGVjayBpZiBlbWFpbCBpcyBjYXNlIHNlbnNpdGl2ZSBpc3N1ZQogICAgICAgICR1c2VyQ2FzZUluc2Vuc2l0aXZlID0gREI6OnRhYmxlKCd1c2VycycpLT53aGVyZVJhdygnTE9XRVIoZW1haWwpID0gPycsIFtzdHJ0b2xvd2VyKCd0aW5hQHBhcmFtZWRpcy5jb20nKV0pLT5maXJzdCgpOwogICAgICAgIGlmICgkdXNlckNhc2VJbnNlbnNpdGl2ZSkgewogICAgICAgICAgICBlY2hvICJGb3VuZCB1c2VyIHdpdGggY2FzZS1pbnNlbnNpdGl2ZSBzZWFyY2g6IHskdXNlckNhc2VJbnNlbnNpdGl2ZS0+ZW1haWx9IiAuIFBIUF9FT0w7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBMaXN0IGFsbCB1c2VycyB0byBzZWUgd2hhdCB3ZSBoYXZlCiAgICBlY2hvIFBIUF9FT0wgLiAiQWxsIHVzZXJzIGluIGRhdGFiYXNlOiIgLiBQSFBfRU9MOwogICAgJGFsbFVzZXJzID0gREI6OnRhYmxlKCd1c2VycycpCiAgICAgICAgLT5sZWZ0Sm9pbigncm9sZXMnLCAndXNlcnMucm9sZV9pZCcsICc9JywgJ3JvbGVzLmlkJykKICAgICAgICAtPnNlbGVjdCgndXNlcnMuaWQnLCAndXNlcnMubmFtZScsICd1c2Vycy5lbWFpbCcsICdyb2xlcy5uYW1lIGFzIHJvbGVfbmFtZScpCiAgICAgICAgLT5nZXQoKTsKICAgICAgICAKICAgIGZvcmVhY2ggKCRhbGxVc2VycyBhcyAkdSkgewogICAgICAgIGVjaG8gIiAgIElEOiB7JHUtPmlkfSwgRW1haWw6IHskdS0+ZW1haWx9LCBSb2xlOiB7JHUtPnJvbGVfbmFtZX0iIC4gUEhQX0VPTDsKICAgIH0KICAgIAp9IGNhdGNoIChFeGNlcHRpb24gJGUpIHsKICAgIGVjaG8gIkVSUk9SOiAiIC4gJGUtPmdldE1lc3NhZ2UoKSAuIFBIUF9FT0w7CiAgICBlY2hvICJGaWxlOiAiIC4gJGUtPmdldEZpbGUoKSAuICI6IiAuICRlLT5nZXRMaW5lKCkgLiBQSFBfRU9MOwp9CgplY2hvIFBIUF9FT0wgLiAiPT09IERFQlVHIENPTVBMRVRFID09PSIgLiBQSFBfRU9MOwo/Pg==' | base64 -d > debug_auth.php\r"
expect -re ".*\\\$.*"

send "php debug_auth.php\r"
expect -re ".*\\\$.*" 
sleep 3

send "exit\r"
expect eof