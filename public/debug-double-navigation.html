<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Double Navigation Debug</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, system-ui;
            background: #1a1a2e;
            color: white;
        }
        
        .debug-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            max-height: 60vh;
            overflow-y: auto;
            background: rgba(0,0,0,0.95);
            padding: 20px;
            z-index: 99999;
            border-bottom: 2px solid #ff0066;
        }
        
        .nav-element {
            margin: 10px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .nav-element.duplicate {
            background: rgba(255,0,0,0.2);
            border-color: #ff0066;
        }
        
        .nav-element h3 {
            margin: 0 0 10px 0;
            color: #00ff88;
        }
        
        .property {
            margin: 5px 0;
            font-size: 12px;
            font-family: monospace;
        }
        
        .property-label {
            color: #00aaff;
            font-weight: bold;
        }
        
        .highlight-red {
            outline: 3px solid red !important;
            outline-offset: -3px;
        }
        
        .highlight-blue {
            outline: 3px solid blue !important;
            outline-offset: -3px;
        }
        
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            background: #00aaff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #0088dd;
        }
        
        .warning {
            background: #ff6600;
            color: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        .success {
            background: #00ff88;
            color: black;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h2>üîç Double Navigation Debugger</h2>
        
        <div class="controls">
            <button onclick="analyzeNavigations()">Analyze Navigation</button>
            <button onclick="highlightNavigations()">Highlight All</button>
            <button onclick="removeNavigations()">Test Remove Each</button>
            <button onclick="checkReactComponents()">Check React Components</button>
            <button onclick="window.location.href='/dokter/mobile-app'">Go to App</button>
        </div>
        
        <div id="status"></div>
        <div id="results"></div>
    </div>
    
    <script>
        let allNavigations = [];
        
        function findAllNavigations() {
            const navigations = [];
            
            // Various selectors to find navigation elements
            const selectors = [
                '.medical-rpg-nav',
                '[class*="bottom"][class*="fixed"]',
                '[class*="fixed"][class*="bottom"]',
                'div[style*="bottom: 0"]',
                'div[style*="bottom:0"]',
                '.emergency-nav',
                'nav',
                '[role="navigation"]',
                '.bottom-nav',
                '[class*="navigation"]'
            ];
            
            // Also check for elements with inline styles
            const allElements = document.querySelectorAll('*');
            allElements.forEach(el => {
                const style = window.getComputedStyle(el);
                const rect = el.getBoundingClientRect();
                
                // Check if element is positioned at bottom
                if (style.position === 'fixed' && 
                    (style.bottom === '0px' || rect.bottom >= window.innerHeight - 100)) {
                    
                    // Check if it's likely a navigation
                    const hasNavClass = el.className.toLowerCase().includes('nav');
                    const hasMultipleChildren = el.children.length > 2;
                    const hasButtons = el.querySelectorAll('button').length > 0;
                    
                    if (hasNavClass || hasMultipleChildren || hasButtons) {
                        navigations.push({
                            element: el,
                            selector: 'Fixed bottom element',
                            source: 'Style detection'
                        });
                    }
                }
            });
            
            // Check using selectors
            selectors.forEach(selector => {
                try {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(el => {
                        // Avoid duplicates
                        if (!navigations.some(nav => nav.element === el)) {
                            navigations.push({
                                element: el,
                                selector: selector,
                                source: 'Selector match'
                            });
                        }
                    });
                } catch (e) {
                    console.error('Invalid selector:', selector);
                }
            });
            
            return navigations;
        }
        
        function analyzeNavigations() {
            allNavigations = findAllNavigations();
            const status = document.getElementById('status');
            const results = document.getElementById('results');
            
            if (allNavigations.length === 0) {
                status.innerHTML = '<div class="warning">No navigation elements found!</div>';
                results.innerHTML = '';
                return;
            }
            
            if (allNavigations.length > 1) {
                status.innerHTML = `<div class="warning">‚ö†Ô∏è Found ${allNavigations.length} navigation elements! This is likely the double navigation issue.</div>`;
            } else {
                status.innerHTML = `<div class="success">‚úÖ Found only ${allNavigations.length} navigation element.</div>`;
            }
            
            results.innerHTML = allNavigations.map((nav, index) => {
                const el = nav.element;
                const rect = el.getBoundingClientRect();
                const style = window.getComputedStyle(el);
                
                // Check if it's a React component
                const reactInfo = getReactInfo(el);
                
                // Get parent info
                const parentInfo = el.parentElement ? {
                    tag: el.parentElement.tagName,
                    className: el.parentElement.className,
                    id: el.parentElement.id
                } : null;
                
                // Check visibility
                const isVisible = style.display !== 'none' && 
                                 style.visibility !== 'hidden' && 
                                 rect.height > 0;
                
                return `
                    <div class="nav-element ${allNavigations.length > 1 ? 'duplicate' : ''}">
                        <h3>Navigation #${index + 1}</h3>
                        <div class="property">
                            <span class="property-label">Found by:</span> ${nav.source} - ${nav.selector}
                        </div>
                        <div class="property">
                            <span class="property-label">Element:</span> ${el.tagName.toLowerCase()}
                        </div>
                        <div class="property">
                            <span class="property-label">Classes:</span> ${el.className || 'none'}
                        </div>
                        <div class="property">
                            <span class="property-label">ID:</span> ${el.id || 'none'}
                        </div>
                        <div class="property">
                            <span class="property-label">Position:</span> ${style.position}
                        </div>
                        <div class="property">
                            <span class="property-label">Bottom:</span> ${style.bottom}
                        </div>
                        <div class="property">
                            <span class="property-label">Z-Index:</span> ${style.zIndex}
                        </div>
                        <div class="property">
                            <span class="property-label">Visible:</span> ${isVisible ? 'YES ‚úÖ' : 'NO ‚ùå'}
                        </div>
                        <div class="property">
                            <span class="property-label">Height:</span> ${rect.height}px
                        </div>
                        <div class="property">
                            <span class="property-label">Children:</span> ${el.children.length}
                        </div>
                        ${parentInfo ? `
                        <div class="property">
                            <span class="property-label">Parent:</span> ${parentInfo.tag}${parentInfo.id ? '#' + parentInfo.id : ''}${parentInfo.className ? '.' + parentInfo.className.split(' ').join('.') : ''}
                        </div>
                        ` : ''}
                        ${reactInfo ? `
                        <div class="property">
                            <span class="property-label">React Component:</span> ${reactInfo}
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        function getReactInfo(element) {
            // Check for React internal properties
            const keys = Object.keys(element);
            const reactKey = keys.find(key => key.startsWith('__react'));
            
            if (reactKey) {
                try {
                    const fiber = element[reactKey];
                    if (fiber && fiber.memoizedProps) {
                        const props = fiber.memoizedProps;
                        if (props.activeTab) {
                            return `MedicalRPGBottomNav (activeTab: ${props.activeTab})`;
                        }
                    }
                    if (fiber && fiber.elementType) {
                        return fiber.elementType.name || 'React Component';
                    }
                } catch (e) {
                    // Silent fail
                }
                return 'React Component (detected)';
            }
            
            return null;
        }
        
        function highlightNavigations() {
            allNavigations = findAllNavigations();
            allNavigations.forEach((nav, index) => {
                nav.element.classList.add(index % 2 === 0 ? 'highlight-red' : 'highlight-blue');
                
                // Add label
                const label = document.createElement('div');
                label.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    background: ${index % 2 === 0 ? 'red' : 'blue'};
                    color: white;
                    padding: 5px 10px;
                    font-size: 14px;
                    z-index: 99999;
                    pointer-events: none;
                `;
                label.textContent = `Nav #${index + 1}`;
                nav.element.style.position = nav.element.style.position || 'relative';
                nav.element.appendChild(label);
            });
        }
        
        function removeNavigations() {
            allNavigations = findAllNavigations();
            if (allNavigations.length <= 1) {
                alert('Only one or no navigation found. Nothing to test.');
                return;
            }
            
            let currentIndex = 0;
            
            function toggleNavigation() {
                // Show all
                allNavigations.forEach(nav => {
                    nav.element.style.display = '';
                });
                
                // Hide current one
                allNavigations[currentIndex].element.style.display = 'none';
                
                alert(`Hidden navigation #${currentIndex + 1}. Check if the issue is resolved. Click OK to test next.`);
                
                currentIndex = (currentIndex + 1) % allNavigations.length;
                
                if (currentIndex === 0) {
                    // Reset all
                    allNavigations.forEach(nav => {
                        nav.element.style.display = '';
                    });
                    alert('All navigations restored.');
                } else {
                    setTimeout(toggleNavigation, 100);
                }
            }
            
            toggleNavigation();
        }
        
        function checkReactComponents() {
            // Check React DevTools
            if (window.__REACT_DEVTOOLS_GLOBAL_HOOK__) {
                console.log('React DevTools detected. Checking for navigation components...');
                
                // Try to find all MedicalRPGBottomNav instances
                const allElements = document.querySelectorAll('*');
                const reactComponents = [];
                
                allElements.forEach(el => {
                    const keys = Object.keys(el);
                    const reactKey = keys.find(key => key.startsWith('__react'));
                    
                    if (reactKey) {
                        try {
                            const fiber = el[reactKey];
                            if (fiber && fiber.elementType && 
                                (fiber.elementType.name === 'MedicalRPGBottomNav' ||
                                 (fiber.memoizedProps && fiber.memoizedProps.activeTab))) {
                                reactComponents.push({
                                    element: el,
                                    component: fiber.elementType.name || 'Unknown',
                                    props: fiber.memoizedProps
                                });
                            }
                        } catch (e) {
                            // Silent fail
                        }
                    }
                });
                
                console.log('Found React navigation components:', reactComponents);
                
                if (reactComponents.length > 1) {
                    alert(`Found ${reactComponents.length} React navigation components! This confirms the double navigation issue.`);
                } else if (reactComponents.length === 1) {
                    alert('Found only 1 React navigation component. The issue might be elsewhere.');
                } else {
                    alert('No React navigation components found. The navigation might not be rendered yet.');
                }
            } else {
                alert('React DevTools not detected. Cannot check React components directly.');
            }
        }
        
        // Auto-run on load
        window.addEventListener('load', () => {
            setTimeout(analyzeNavigations, 1000);
        });
        
        // Monitor DOM changes
        const observer = new MutationObserver(() => {
            const currentCount = findAllNavigations().length;
            const prevCount = allNavigations.length;
            
            if (currentCount !== prevCount && currentCount > 1) {
                console.warn(`Navigation count changed from ${prevCount} to ${currentCount}`);
                analyzeNavigations();
            }
        });
        
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
    </script>
</body>
</html>