<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Mobile Diagnostic</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, system-ui, sans-serif;
            background: #1a202c;
            color: #fff;
            line-height: 1.6;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        h1 {
            color: #60a5fa;
            font-size: 24px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card h2 {
            margin-top: 0;
            color: #a5b4fc;
            font-size: 18px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .label {
            color: #9ca3af;
        }
        
        .value {
            color: #10b981;
            font-family: monospace;
            font-size: 14px;
        }
        
        .success {
            background: #10b981;
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .error {
            background: #ef4444;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            width: 100%;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .button:active {
            background: #2563eb;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 10px;
        }
        
        input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .links {
            margin-top: 30px;
            text-align: center;
        }
        
        .links a {
            color: #60a5fa;
            text-decoration: none;
            display: block;
            margin: 10px 0;
            padding: 10px;
            background: rgba(96, 165, 250, 0.1);
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± Mobile Diagnostic Tool</h1>
        
        <div class="success" id="js-status">
            ‚úÖ JavaScript is working!
        </div>
        
        <div class="card">
            <h2>Device Information</h2>
            <div class="info-item">
                <span class="label">Platform:</span>
                <span class="value" id="platform">Loading...</span>
            </div>
            <div class="info-item">
                <span class="label">Device:</span>
                <span class="value" id="device">Loading...</span>
            </div>
            <div class="info-item">
                <span class="label">Screen Size:</span>
                <span class="value" id="screen">Loading...</span>
            </div>
            <div class="info-item">
                <span class="label">Viewport:</span>
                <span class="value" id="viewport">Loading...</span>
            </div>
            <div class="info-item">
                <span class="label">Pixel Ratio:</span>
                <span class="value" id="pixelRatio">Loading...</span>
            </div>
        </div>
        
        <div class="card">
            <h2>Browser Features</h2>
            <div class="info-item">
                <span class="label">Touch Support:</span>
                <span class="value" id="touch">Loading...</span>
            </div>
            <div class="info-item">
                <span class="label">Visual Viewport:</span>
                <span class="value" id="visualViewport">Loading...</span>
            </div>
            <div class="info-item">
                <span class="label">Safe Areas:</span>
                <span class="value" id="safeAreas">Loading...</span>
            </div>
            <div class="info-item">
                <span class="label">Cookies Enabled:</span>
                <span class="value" id="cookies">Loading...</span>
            </div>
        </div>
        
        <div class="card">
            <h2>Connection Test</h2>
            <div class="info-item">
                <span class="label">Current URL:</span>
                <span class="value" id="currentUrl" style="word-break: break-all; font-size: 12px;">Loading...</span>
            </div>
            <div class="info-item">
                <span class="label">Protocol:</span>
                <span class="value" id="protocol">Loading...</span>
            </div>
            <button class="button" onclick="testConnection()">Test Server Connection</button>
            <div id="connectionResult"></div>
        </div>
        
        <div class="card">
            <h2>Input Test</h2>
            <p style="color: #9ca3af; font-size: 14px;">Test if input zooms on focus (it shouldn't with font-size: 16px)</p>
            <input type="text" placeholder="Tap here to test input" />
        </div>
        
        <div class="links">
            <h3>Test Other Pages:</h3>
            <a href="/login">Login Page</a>
            <a href="/test-127-login.html">Test Login Tool</a>
            <a href="/mobile-test-guide.html">Mobile Test Guide</a>
        </div>
    </div>
    
    <script>
        // Error handler
        window.onerror = function(msg, url, line) {
            document.body.innerHTML = '<div class="error">JavaScript Error: ' + msg + ' at line ' + line + '</div>' + document.body.innerHTML;
        };
        
        // Update device info
        function updateInfo() {
            try {
                // Platform
                document.getElementById('platform').textContent = navigator.platform || 'Unknown';
                
                // Device detection
                const ua = navigator.userAgent;
                let device = 'Unknown';
                if (/iPhone/.test(ua)) device = 'iPhone';
                else if (/iPad/.test(ua)) device = 'iPad';
                else if (/Android/.test(ua)) device = 'Android';
                else device = 'Desktop/Other';
                document.getElementById('device').textContent = device;
                
                // Screen
                document.getElementById('screen').textContent = screen.width + ' √ó ' + screen.height;
                
                // Viewport
                document.getElementById('viewport').textContent = window.innerWidth + ' √ó ' + window.innerHeight;
                
                // Pixel ratio
                document.getElementById('pixelRatio').textContent = window.devicePixelRatio || 1;
                
                // Touch support
                const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                document.getElementById('touch').textContent = hasTouch ? 'Yes' : 'No';
                
                // Visual viewport
                const hasVisualViewport = 'visualViewport' in window;
                document.getElementById('visualViewport').textContent = hasVisualViewport ? 'Supported' : 'Not supported';
                
                // Safe areas
                const style = getComputedStyle(document.documentElement);
                const safeTop = style.getPropertyValue('env(safe-area-inset-top)') || '0px';
                document.getElementById('safeAreas').textContent = safeTop !== '0px' ? 'Detected' : 'None';
                
                // Cookies
                document.getElementById('cookies').textContent = navigator.cookieEnabled ? 'Yes' : 'No';
                
                // URL info
                document.getElementById('currentUrl').textContent = window.location.href;
                document.getElementById('protocol').textContent = window.location.protocol;
                
            } catch (e) {
                document.body.innerHTML = '<div class="error">Error updating info: ' + e.message + '</div>' + document.body.innerHTML;
            }
        }
        
        // Test connection
        window.testConnection = async function() {
            const resultDiv = document.getElementById('connectionResult');
            resultDiv.innerHTML = '<p style="color: #fbbf24; margin-top: 10px;">Testing...</p>';
            
            try {
                const response = await fetch('/api/health', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok || response.status === 404) {
                    resultDiv.innerHTML = '<p style="color: #10b981; margin-top: 10px;">‚úÖ Server connection OK (Status: ' + response.status + ')</p>';
                } else {
                    resultDiv.innerHTML = '<p style="color: #ef4444; margin-top: 10px;">‚ùå Server error: ' + response.status + '</p>';
                }
            } catch (e) {
                resultDiv.innerHTML = '<p style="color: #ef4444; margin-top: 10px;">‚ùå Connection failed: ' + e.message + '</p>';
            }
        };
        
        // Initialize
        updateInfo();
        
        // Update on resize
        window.addEventListener('resize', updateInfo);
        window.addEventListener('orientationchange', function() {
            setTimeout(updateInfo, 100);
        });
    </script>
</body>
</html>