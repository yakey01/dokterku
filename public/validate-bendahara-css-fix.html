<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bendahara CSS Fix Validation</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a0b 0%, #111118 100%);
            color: #fafafa;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .validation-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            background: linear-gradient(135deg, #111118 0%, #1a1a20 100%);
            border: 1px solid #333340;
            border-radius: 1rem;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.8);
        }
        
        .test-result {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
        }
        
        .success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.4);
            color: #22c55e;
        }
        
        .error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #ef4444;
        }
        
        .warning {
            background: rgba(251, 189, 35, 0.2);
            border: 1px solid rgba(251, 189, 35, 0.4);
            color: #fbbf23;
        }
        
        .info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            color: #3b82f6;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(100, 126, 234, 0.3);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #333340;
            border-radius: 8px;
            padding: 15px;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.875rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .code-block {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333340;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .simulation-area {
            border: 2px dashed #333340;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        /* Simulate problematic elements */
        .simulated-card {
            background: white;
            padding: 20px;
            margin: 10px;
            border-radius: 8px;
            color: #000;
            border: 1px solid #e5e7eb;
        }
        
        .simulated-text {
            color: #374151;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="validation-container">
        <h1>üîç Bendahara CSS Fix Validation Suite</h1>
        <p>Comprehensive testing for the 11 persistent CSS conflicts resolution</p>
        
        <div class="test-section">
            <h2>üìä Real-Time Metrics</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="conflict-count">-</div>
                    <div class="metric-label">CSS Conflicts Detected</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="elements-processed">-</div>
                    <div class="metric-label">Elements Processed</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="success-rate">-</div>
                    <div class="metric-label">Fix Success Rate</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="performance-score">-</div>
                    <div class="metric-label">Performance Score</div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üß™ CSS Specificity Tests</h2>
            <button onclick="testCSSSpecificity()">Test CSS Specificity</button>
            <button onclick="testPanelIDDetection()">Test Panel ID Detection</button>
            <button onclick="testDynamicContent()">Test Dynamic Content</button>
            <div id="specificity-results"></div>
        </div>
        
        <div class="test-section">
            <h2>üîÑ Dynamic Content Simulation</h2>
            <button onclick="simulateAjaxLoad()">Simulate AJAX Load</button>
            <button onclick="simulateLivewireUpdate()">Simulate Livewire Update</button>
            <button onclick="simulateChartRender()">Simulate Chart Render</button>
            
            <div class="simulation-area" id="dynamic-area">
                <p>Dynamic content will appear here...</p>
            </div>
            <div id="dynamic-results"></div>
        </div>
        
        <div class="test-section">
            <h2>‚ö° Performance Analysis</h2>
            <button onclick="runPerformanceTest()">Run Performance Test</button>
            <button onclick="measureSpecificity()">Measure CSS Specificity</button>
            <button onclick="analyzeConflicts()">Analyze Conflicts</button>
            <div id="performance-results"></div>
        </div>
        
        <div class="test-section">
            <h2>üìã Comprehensive Report</h2>
            <button onclick="generateReport()">Generate Full Report</button>
            <div id="comprehensive-report"></div>
        </div>
        
        <div class="test-section">
            <h2>üîß Debug Tools</h2>
            <button onclick="injectTestElements()">Inject Test Elements</button>
            <button onclick="clearTestElements()">Clear Test Elements</button>
            <button onclick="exportResults()">Export Results</button>
            <div id="debug-output"></div>
        </div>
    </div>

    <script>
        class BendaharaCSSValidator {
            constructor() {
                this.testResults = {};
                this.performanceMetrics = {};
                this.conflictHistory = [];
                this.startTime = performance.now();
                
                this.init();
            }
            
            init() {
                console.log('üéØ Bendahara CSS Validator initialized');
                this.startRealtimeMonitoring();
                this.checkForThemeEnforcer();
            }
            
            checkForThemeEnforcer() {
                const hasEnforcer = window.bendaharaThemeEnforcer || window.BendaharaDynamicThemeEnforcer;
                if (hasEnforcer) {
                    this.showResult('info', 'success-rate', '‚úÖ Dynamic Theme Enforcer detected');
                } else {
                    this.showResult('warning', 'success-rate', '‚ö†Ô∏è Dynamic Theme Enforcer not found');
                }
            }
            
            startRealtimeMonitoring() {
                setInterval(() => {
                    this.updateMetrics();
                }, 1000);
            }
            
            updateMetrics() {
                const conflicts = this.scanForConflicts();
                const elementsProcessed = document.querySelectorAll('[style*="background"]').length;
                const successRate = conflicts === 0 ? '100%' : Math.max(0, 100 - (conflicts * 10)) + '%';
                const performanceScore = Math.round(100 - (performance.now() - this.startTime) / 100);
                
                document.getElementById('conflict-count').textContent = conflicts;
                document.getElementById('elements-processed').textContent = elementsProcessed;
                document.getElementById('success-rate').textContent = successRate;
                document.getElementById('performance-score').textContent = performanceScore + '/100';
                
                // Update colors based on results
                const conflictEl = document.getElementById('conflict-count');
                conflictEl.style.color = conflicts === 0 ? '#22c55e' : conflicts < 5 ? '#fbbf23' : '#ef4444';
            }
            
            scanForConflicts() {
                const cards = document.querySelectorAll('.bg-white, .dark\\:bg-gray-800, [class*="bg-gray"]');
                let conflicts = 0;
                
                cards.forEach(card => {
                    if (!card.closest('.fi-sidebar') && !card.closest('.fi-topbar')) {
                        const bg = window.getComputedStyle(card).backgroundColor;
                        if (!bg.includes('10, 10, 11') && !bg.includes('17, 17, 24') && bg !== 'rgba(0, 0, 0, 0)') {
                            conflicts++;
                        }
                    }
                });
                
                this.conflictHistory.push({ timestamp: Date.now(), count: conflicts });
                return conflicts;
            }
            
            testCSSSpecificity() {
                const results = [];
                
                // Test 1: Panel ID selector
                const panelElements = document.querySelectorAll('[data-filament-panel-id="bendahara"]');
                results.push({
                    test: 'Panel ID Detection',
                    result: panelElements.length > 0 ? 'PASS' : 'FAIL',
                    details: `Found ${panelElements.length} elements with panel ID`
                });
                
                // Test 2: CSS specificity
                const testElement = document.createElement('div');
                testElement.className = 'bg-white test-element';
                document.body.appendChild(testElement);
                
                const computedStyle = window.getComputedStyle(testElement);
                const hasBlackBg = computedStyle.backgroundColor.includes('10, 10, 11');
                
                results.push({
                    test: 'CSS Specificity Override',
                    result: hasBlackBg ? 'PASS' : 'FAIL',
                    details: `Background color: ${computedStyle.backgroundColor}`
                });
                
                document.body.removeChild(testElement);
                
                this.displayResults('specificity-results', results);
            }
            
            testPanelIDDetection() {
                const tests = [
                    '[data-filament-panel-id="bendahara"]',
                    '.fi-main',
                    '.grid',
                    '.bg-white'
                ];
                
                const results = tests.map(selector => {
                    const elements = document.querySelectorAll(selector);
                    return {
                        test: `Selector: ${selector}`,
                        result: elements.length > 0 ? 'FOUND' : 'NOT_FOUND',
                        details: `${elements.length} elements found`
                    };
                });
                
                this.displayResults('specificity-results', results);
            }
            
            simulateAjaxLoad() {
                const container = document.getElementById('dynamic-area');
                const ajaxContent = `
                    <div class="simulated-card bg-white" data-test="ajax-card">
                        <h3 class="simulated-text">AJAX Loaded Card</h3>
                        <p class="simulated-text">This simulates content loaded via AJAX</p>
                    </div>
                `;
                
                container.innerHTML = ajaxContent;
                
                setTimeout(() => {
                    const newCard = container.querySelector('[data-test="ajax-card"]');
                    const bg = window.getComputedStyle(newCard).backgroundColor;
                    const isFixed = bg.includes('10, 10, 11');
                    
                    this.showResult('dynamic-results', isFixed ? 'success' : 'error', 
                        isFixed ? '‚úÖ AJAX content properly themed' : '‚ùå AJAX content not themed');
                }, 100);
            }
            
            simulateLivewireUpdate() {
                const container = document.getElementById('dynamic-area');
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm p-4" wire:loading.remove>
                        <h4 class="text-gray-900">Livewire Component</h4>
                        <p class="text-gray-600">This simulates a Livewire update</p>
                    </div>
                `;
                
                // Simulate the theme enforcer response
                if (window.bendaharaThemeEnforcer) {
                    window.bendaharaThemeEnforcer.forceApplyTheme();
                }
                
                setTimeout(() => {
                    const conflicts = this.scanForConflicts();
                    this.showResult('dynamic-results', conflicts === 0 ? 'success' : 'warning',
                        `Livewire simulation: ${conflicts} conflicts detected`);
                }, 200);
            }
            
            runPerformanceTest() {
                const startTime = performance.now();
                
                // Simulate heavy DOM manipulation
                const testElements = [];
                for (let i = 0; i < 100; i++) {
                    const el = document.createElement('div');
                    el.className = 'bg-white test-perf-element';
                    document.body.appendChild(el);
                    testElements.push(el);
                }
                
                // Measure theme application time
                const themeStartTime = performance.now();
                testElements.forEach(el => {
                    el.style.setProperty('background', 'linear-gradient(135deg, #0a0a0b 0%, #111118 100%)', 'important');
                });
                const themeEndTime = performance.now();
                
                // Cleanup
                testElements.forEach(el => document.body.removeChild(el));
                
                const totalTime = performance.now() - startTime;
                const themeTime = themeEndTime - themeStartTime;
                
                const results = [
                    { metric: 'Total Performance Test Time', value: `${totalTime.toFixed(2)}ms` },
                    { metric: 'Theme Application Time', value: `${themeTime.toFixed(2)}ms` },
                    { metric: 'Elements Per Second', value: `${Math.round(100 / (themeTime / 1000))}` },
                    { metric: 'Performance Score', value: totalTime < 100 ? 'EXCELLENT' : totalTime < 500 ? 'GOOD' : 'NEEDS_IMPROVEMENT' }
                ];
                
                this.displayPerformanceResults('performance-results', results);
            }
            
            generateReport() {
                const report = {
                    timestamp: new Date().toISOString(),
                    conflicts: this.scanForConflicts(),
                    conflictHistory: this.conflictHistory.slice(-10),
                    performance: this.performanceMetrics,
                    recommendations: this.generateRecommendations()
                };
                
                const reportHtml = `
                    <div class="code-block">
                        <h4>üìã Comprehensive Analysis Report</h4>
                        <p><strong>Timestamp:</strong> ${report.timestamp}</p>
                        <p><strong>Current Conflicts:</strong> ${report.conflicts}</p>
                        <p><strong>Recommendations:</strong></p>
                        <ul>
                            ${report.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                `;
                
                document.getElementById('comprehensive-report').innerHTML = reportHtml;
            }
            
            generateRecommendations() {
                const conflicts = this.scanForConflicts();
                const recommendations = [];
                
                if (conflicts > 0) {
                    recommendations.push('üîß Enable Dynamic Theme Enforcer for persistent conflicts');
                    recommendations.push('üìù Add ultimate-css-fix.css to theme imports');
                    recommendations.push('‚ö° Implement mutation observer for dynamic content');
                }
                
                if (conflicts === 0) {
                    recommendations.push('‚úÖ All conflicts resolved - system working properly');
                    recommendations.push('üìä Monitor performance for optimization opportunities');
                }
                
                const panelElements = document.querySelectorAll('[data-filament-panel-id="bendahara"]');
                if (panelElements.length === 0) {
                    recommendations.push('üéØ Panel ID attribute not detected - use global selectors');
                }
                
                return recommendations;
            }
            
            displayResults(containerId, results) {
                const html = results.map(result => 
                    `<div class="test-result ${result.result === 'PASS' || result.result === 'FOUND' ? 'success' : result.result === 'FAIL' || result.result === 'NOT_FOUND' ? 'error' : 'info'}">
                        <strong>${result.test}:</strong> ${result.result}<br>
                        <small>${result.details}</small>
                    </div>`
                ).join('');
                
                document.getElementById(containerId).innerHTML = html;
            }
            
            displayPerformanceResults(containerId, results) {
                const html = results.map(result =>
                    `<div class="test-result info">
                        <strong>${result.metric}:</strong> ${result.value}
                    </div>`
                ).join('');
                
                document.getElementById(containerId).innerHTML = html;
            }
            
            showResult(containerId, type, message) {
                const container = document.getElementById(containerId);
                const div = document.createElement('div');
                div.className = `test-result ${type}`;
                div.textContent = message;
                container.appendChild(div);
            }
            
            injectTestElements() {
                const container = document.getElementById('debug-output');
                container.innerHTML = `
                    <div class="bg-white p-4 rounded-lg border">Test Card 1</div>
                    <div class="dark:bg-gray-800 p-4 rounded-lg">Test Card 2</div>
                    <div class="bg-gray-100 p-4 rounded-lg">Test Card 3</div>
                `;
                
                setTimeout(() => {
                    const conflicts = this.scanForConflicts();
                    this.showResult('debug-output', conflicts === 0 ? 'success' : 'warning',
                        `Test elements injected. Conflicts: ${conflicts}`);
                }, 100);
            }
            
            clearTestElements() {
                document.getElementById('debug-output').innerHTML = '';
                document.querySelectorAll('.test-perf-element').forEach(el => el.remove());
            }
        }
        
        // Global functions for buttons
        const validator = new BendaharaCSSValidator();
        
        function testCSSSpecificity() { validator.testCSSSpecificity(); }
        function testPanelIDDetection() { validator.testPanelIDDetection(); }
        function testDynamicContent() { validator.testPanelIDDetection(); }
        function simulateAjaxLoad() { validator.simulateAjaxLoad(); }
        function simulateLivewireUpdate() { validator.simulateLivewireUpdate(); }
        function simulateChartRender() { validator.simulateAjaxLoad(); }
        function runPerformanceTest() { validator.runPerformanceTest(); }
        function measureSpecificity() { validator.testCSSSpecificity(); }
        function analyzeConflicts() { validator.updateMetrics(); }
        function generateReport() { validator.generateReport(); }
        function injectTestElements() { validator.injectTestElements(); }
        function clearTestElements() { validator.clearTestElements(); }
        function exportResults() { 
            const data = JSON.stringify(validator.conflictHistory, null, 2);
            console.log('Export data:', data);
            alert('Results exported to console');
        }
    </script>
</body>
</html>